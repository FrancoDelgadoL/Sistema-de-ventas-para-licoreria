@model List<Ezel_Market.Models.ProductoVistaModel>
@{
    ViewData["Title"] = "CatÃ¡logo de Productos";
}

<link rel="stylesheet" href="~/css/Cliente/VistaInicio.css" />

<header class="navbar">
    <div class="nav-left">
        <h1 class="logo">Ezel Market</h1>
    </div>

    <div class="nav-right">
        <button id="btnPerfil" class="perfil-btn" onclick="location.href='@Url.Action("Perfil","Cliente")'">
            <span class="perfil-circle">C</span>
            <span class="perfil-text">Mi Perfil</span>
        </button>

        <button id="btnCarrito" class="carrito-btn" aria-haspopup="dialog" aria-controls="carritoModal">
            ðŸ›’ <span id="contadorCarrito">0</span>
        </button>
    </div>
</header>

<main class="container">
    <section class="catalogo-header">
        <h2>CatÃ¡logo de Productos</h2>
        <p>Descubre nuestras mejores bebidas y snacks. â€” Calidad y buen precio.</p>
    </section>

    <!-- FILTROS MEJORADOS -->
    <section class="filtros-container">
        <input id="buscador" type="text" placeholder="Buscar por nombre, marca o categorÃ­a..." class="filtro-input" />
        <select id="selectCategoria" class="filtro-select">
            <option value="">Todas las categorÃ­as</option>
            @foreach (var categoria in ViewBag.Categorias)
            {
                <option value="@categoria">@categoria</option>
            }
        </select>
        <button id="btnLimpiarFiltros" class="filtro-btn">Limpiar Filtros</button>
    </section>

    <!-- CONTADOR DE RESULTADOS -->
    <div class="resultados-info">
        <span id="contadorResultados">Mostrando @Model.Count productos</span>
    </div>

    <!-- PRODUCTOS DESDE BASE DE DATOS -->
    <section class="catalogo-grid">
        @foreach (var producto in Model)
        {
            <article class="producto-card" 
                     data-categoria="@producto.Categoria" 
                     data-nombre="@producto.Nombre" 
                     data-marca="@producto.Marca"
                     data-precio="@producto.Precio.ToString("0.00")" 
                     data-img="@producto.Imagen"
                     data-id="@producto.Id"
                     data-stock="@producto.CantidadStock">
                
                @if (producto.CantidadStock < 10 && producto.CantidadStock > 0)
                {
                    <div class="card-top">
                        <span class="descuento">Â¡Ãšltimas unidades!</span>
                    </div>
                }
                else if (producto.CantidadStock == 0)
                {
                    <div class="card-top">
                        <span class="agotado">Agotado</span>
                    </div>
                }
                
                <img src="@producto.Imagen" alt="@producto.Nombre" class="producto-img" onerror="this.src='https://via.placeholder.com/200x200?text=Imagen+No+Disponible'" />
                
                <h4 class="producto-nombre">@producto.Nombre</h4>
                
                @if (!string.IsNullOrEmpty(producto.Marca))
                {
                    <p class="producto-marca">@producto.Marca</p>
                }
                
                @if (producto.GradoAlcohol.HasValue)
                {
                    <p class="producto-grado">@producto.GradoAlcohol.Value.ToString("0.0")% Alc.</p>
                }
                
                <div class="precios">
                    <span class="precio-actual">S/ @producto.Precio.ToString("0.00")</span>
                </div>
                
                <div class="stock-info">
                    @if (producto.CantidadStock > 0)
                    {
                        <span class="stock-disponible">Stock: @producto.CantidadStock</span>
                    }
                    else
                    {
                        <span class="stock-agotado">Agotado</span>
                    }
                </div>
                
                <div class="card-actions">
                    @if (producto.CantidadStock > 0)
                    {
                        <button class="btn-agregar" title="Agregar rÃ¡pido">+</button>
                    }
                    <button class="btn-ver" title="Ver detalles">Ver</button>
                </div>
            </article>
        }
        
        @if (!Model.Any())
        {
            <div class="no-productos">
                <p>No hay productos disponibles en este momento.</p>
            </div>
        }
    </section>
</main>

<!-- MODALES (mantener igual que antes) -->
<div id="productoModal" class="modal" role="dialog" aria-hidden="true">
    <!-- ... tu modal de producto igual ... -->
</div>

<div id="carritoModal" class="modal carrito-modal" role="dialog" aria-hidden="true">
    <!-- ... tu modal de carrito igual ... -->
</div>

<!-- SCRIPTS MEJORADOS -->
<script>
    // ---------- Estado ----------
    let carrito = [];
    const IGV_RATE = 0.18;
    let productosOriginales = []; // Para guardar todos los productos

    // Selectores
    const productoCards = document.querySelectorAll('.producto-card');
    const contadorCarrito = document.getElementById('contadorCarrito');
    const contadorResultados = document.getElementById('contadorResultados');
    const btnLimpiarFiltros = document.getElementById('btnLimpiarFiltros');

    // Guardar productos originales al cargar la pÃ¡gina
    document.addEventListener('DOMContentLoaded', function() {
        productosOriginales = Array.from(productoCards);
    });

    // ---------- FILTROS MEJORADOS ----------
    document.getElementById('buscador').addEventListener('input', function(e) {
        aplicarFiltros();
    });

    document.getElementById('selectCategoria').addEventListener('change', function(e) {
        aplicarFiltros();
    });

    btnLimpiarFiltros.addEventListener('click', function() {
        document.getElementById('buscador').value = '';
        document.getElementById('selectCategoria').value = '';
        aplicarFiltros();
    });

    function aplicarFiltros() {
        const textoBusqueda = document.getElementById('buscador').value.toLowerCase();
        const categoriaSeleccionada = document.getElementById('selectCategoria').value;
        
        let productosVisibles = 0;

        productosOriginales.forEach(card => {
            const nombre = card.dataset.nombre.toLowerCase();
            const marca = card.dataset.marca.toLowerCase();
            const categoria = card.dataset.categoria.toLowerCase();
            
            const coincideTexto = nombre.includes(textoBusqueda) || 
                                marca.includes(textoBusqueda) || 
                                categoria.includes(textoBusqueda);
            
            const coincideCategoria = !categoriaSeleccionada || 
                                    card.dataset.categoria === categoriaSeleccionada;
            
            const mostrar = coincideTexto && coincideCategoria;
            
            card.style.display = mostrar ? '' : 'none';
            if (mostrar) productosVisibles++;
        });

        // Actualizar contador de resultados
        contadorResultados.textContent = `Mostrando ${productosVisibles} de ${productosOriginales.length} productos`;
        
        // Mostrar mensaje si no hay resultados
        const catalogoGrid = document.querySelector('.catalogo-grid');
        let mensajeNoResultados = catalogoGrid.querySelector('.no-resultados');
        
        if (productosVisibles === 0) {
            if (!mensajeNoResultados) {
                mensajeNoResultados = document.createElement('div');
                mensajeNoResultados.className = 'no-resultados';
                mensajeNoResultados.innerHTML = `
                    <p>No se encontraron productos que coincidan con tu bÃºsqueda.</p>
                    <button onclick="limpiarFiltrosRapido()">Mostrar todos los productos</button>
                `;
                catalogoGrid.appendChild(mensajeNoResultados);
            }
        } else if (mensajeNoResultados) {
            mensajeNoResultados.remove();
        }
    }

    function limpiarFiltrosRapido() {
        document.getElementById('buscador').value = '';
        document.getElementById('selectCategoria').value = '';
        aplicarFiltros();
    }

    // ---------- Resto de tu cÃ³digo JavaScript (carrito, modales, etc.) ----------
    // ... (MantÃ©n todo tu cÃ³digo JavaScript original de carrito y modales aquÃ­) ...

    // Helper functions
    function actualizarContador() {
        const totalCantidad = carrito.reduce((s, it) => s + it.cantidad, 0);
        contadorCarrito.textContent = totalCantidad;
    }

    function formatearPrecio(n) {
        return `S/ ${parseFloat(n).toFixed(2)}`;
    }

    // ... (todo el resto de tu cÃ³digo JavaScript igual) ...
</script>