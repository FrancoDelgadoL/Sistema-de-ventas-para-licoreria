@* PASO 1: Especificar el ViewModel que esta vista recibe *@
@model Ezel_Market.Models.ClienteCatalogoViewModel

@{
    ViewData["Title"] = "Cat√°logo de Productos";
}

<link rel="stylesheet" href="~/css/Cliente/VistaInicio.css" />

<header class="navbar">
    <!-- ... Tu header se mantiene igual ... -->
    <div class="nav-left">
        <h1 class="logo">Ezel Market</h1>
    </div>
    <div class="nav-right">
        <button id="btnPerfil" class="perfil-btn" onclick="location.href='@Url.Action("Perfil","Cliente")'">
            <span class="perfil-circle">C</span>
            <span class="perfil-text">Mi Perfil</span>
        </button>
        <button id="btnCarrito" class="carrito-btn" aria-haspopup="dialog" aria-controls="carritoModal">
            üõí <span id="contadorCarrito">0</span>
        </button>
    </div>
</header>

<main class="container">
    <section class="catalogo-header">
        <h2>Cat√°logo de Productos</h2>
        <p>Descubre nuestras mejores bebidas y snacks. ‚Äî Calidad y buen precio.</p>
    </section>

    <!-- FILTROS (ACTUALIZADOS) -->
    <section class="filtros-container">
        <input id="buscador" type="text" placeholder="Buscar producto..." class="filtro-input" />
        
        @* PASO 2: Llenar el <select> din√°micamente desde el Modelo *@
        <select id="selectCategoria" class="filtro-select">
            <option value="">Todas las categor√≠as</option>
            @if (Model.Categorias != null)
            {
                @foreach (var cat in Model.Categorias)
                {
                    <option value="@cat.Nombre">@cat.Nombre</option>
                }
            }
        </select>
    </section>

    <!-- PRODUCTOS (ACTUALIZADOS) -->
    <section class="catalogo-grid">
        
        @* PASO 3: Reemplazar el @for est√°tico por un @foreach del Modelo *@
        @if (Model.Productos != null && Model.Productos.Any())
        {
            @foreach (var producto in Model.Productos)
            {
                <article class="producto-card" 
                         data-categoria="@producto.Categoria.Nombre" 
                         data-nombre="@producto.NombreProducto" 
                         data-precio="@producto.PrecioVentaMinorista" 
                         data-img="@producto.Imagen">
                    
                    <div class="card-top">
                        @* L√≥gica de descuento (si aplica) - Por ahora la quitamos
                           ya que el modelo no tiene "Precio Antiguo"
                        <span class="descuento">-30%</span> 
                        *@
                    </div>

                    @* Usamos la imagen del producto o un placeholder si no existe *@
                    <img src="@(string.IsNullOrEmpty(producto.Imagen) ? "https://placehold.co/400x400/333/FFF?text=" + producto.NombreProducto[0] : producto.Imagen)" 
                         alt="@producto.NombreProducto" 
                         class="producto-img" />
                         
                    <h4 class="producto-nombre">@producto.NombreProducto</h4>
                    
                    <div class="precios">
                        <span class="precio-actual">S/ @producto.PrecioVentaMinorista.ToString("F2")</span>
                        
                        @* Si quisieras mostrar el precio mayorista como "antiguo"
                           podr√≠as usar una l√≥gica aqu√≠, por ahora lo ocultamos.
                        <span class="precio-antiguo">S/ 90.70</span> 
                        *@
                    </div>
                    
                    <div class="card-actions">
                        <button class="btn-agregar" title="Agregar r√°pido">+</button>
                        <button class="btn-ver" title="Ver detalles">Ver</button>
                    </div>
                </article>
            }
        }
        else
        {
            <p style="grid-column: 1 / -1; text-align: center; color: #888;">
                No se encontraron productos en el inventario.
            </p>
        }

    </section>
</main>

<!-- ... (El resto de tu HTML con los MODALS y el SCRIPT se mantiene 100% igual) ... -->
<!-- MODAL PRODUCTO -->
<div id="productoModal" class="modal" role="dialog" aria-hidden="true">
    <!-- ... (contenido) ... -->
</div>

<!-- MODAL CARRITO -->
<div id="carritoModal" class="modal carrito-modal" role="dialog" aria-hidden="true">
    <!-- ... (contenido) ... -->
</div>

<!-- SCRIPTS -->
<script>
    // ¬°TU SCRIPT DE JAVASCRIPT SE MANTIENE EXACTAMENTE IGUAL!
    // El JavaScript que ya ten√≠as funcionar√° perfectamente con
    // los 'data-attributes' que acabamos de poner en el HTML din√°mico.
    
    // ---------- Estado ----------
    let carrito = []; // {id, nombre, precio, img, cantidad}
    const IGV_RATE = 0.18;

    // Selectores
    const productoCards = document.querySelectorAll('.producto-card');
    const contadorCarrito = document.getElementById('contadorCarrito');

    // ... (el resto de tu JS) ...
    
    // filtro b√∫squeda simple
    document.getElementById('buscador').addEventListener('input', (e)=>{
        const q = e.target.value.toLowerCase();
        document.querySelectorAll('.producto-card').forEach(card=>{
            const nombre = card.dataset.nombre.toLowerCase();
            card.style.display = nombre.includes(q) ? '' : 'none';
        });
    });
    
    // Esta funci√≥n de filtro de categor√≠a AHORA FUNCIONAR√Å
    // porque los <option> y los data-categoria coinciden.
    document.getElementById('selectCategoria').addEventListener('change', (e)=>{
        const cat = e.target.value;
        document.querySelectorAll('.producto-card').forEach(card=>{
            if (!cat) card.style.display = '';
            else card.style.display = (card.dataset.categoria === cat) ? '' : 'none';
        });
    });
    
    // ... (el resto de tu JS) ...
</script>